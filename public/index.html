<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Bokkusu edit</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta name="description" content="">
        <meta name="author" content="">

        <!-- Le styles -->
        <link href="/css/bootstrap.min.css" rel="stylesheet">
        <link href="/css/bootstrap-responsive.min.css" rel="stylesheet">
        <link href="/css/jsoneditor.css" rel="stylesheet">

    </head>
    <body>
        <div class="container">
            <div class="control-group">
                <form action="#" class="form-search">
                    <input type="text" name="key" id="key" class="input-medium search-query"/>
                    <a href="#" id="search" class="btn"><i class="icon-search"></i></a>
                </form>
            </div>
            <div class="editor">
                <div class="btn-group">
                    <a class="btn" href="#" id="save"><i class="icon-pencil"></i>Save</a>
                    <a class="btn disabled" href="#" id="undo"><i class="icon-refresh"></i>Undo</a>
                    <a class="btn disabled" href="#" id="delete"><i class="icon-trash"></i>Delete</a>
                </div>
                <ul class="nav nav-tabs">
                    <li class="active"><a href="#mate" data-toggle="tab">Mate</a></li>
                    <li><a href="#yaml" data-toggle="tab">Yaml</a></li>
                    <li><a href="#raw" data-toggle="tab">Raw</a></li>
                </ul>

                <div class="tab-content">
                    <div class="tab-pane active" id="mate">
                        <div id="mate-editor" class="json-editor"></div>
                    </div>
                    <div class="tab-pane" id="yaml">
                        <form action="#" class="form-search">
                            <textarea rows="3" id="yaml-editor"></textarea>
                        </form>

                    </div>
                    <div class="tab-pane" id="raw">...</div>
                </div>
            </div>

        </div>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
        <script src="/js/bootstrap.min.js"></script>
        <script src="/js/js-yaml.min.js"></script>
        <script src="/js/jquery.jsoneditor.min.js"></script>
        <script>
            $(function() {
                $('#myTab a:last').tab('show');
                var key="tdurden";
                var current=null;
                var editor = $('#editor');
                var load = function() {
                    $.getJSON('/data/' + key, function(data, status, xhr) {
                        editor.trigger('dataloaded', data);
                        $('#yaml-editor').val(jsyaml.dump(data));
                        $('#mate-editor').jsonEditor(data, {change: function() {
                            current = this.original;
                        }});
                        $('#editor').show()
                    }).error(function() {
                        $('#editor').hide();
                    });;
                }
                editor.on('dataloaded', function(evt, data) {
                    console.log("just loaded that", data);
                });
                var loadkey = function() {
                    key = $('#key').val();
                    load();
                    return false;
                }
                $('form').submit(loadkey);
                $('#search').click(loadkey);
                $('#save').click(function() {
                    $.ajax('/data/' + key, {
                        data: current,
                        mimeType:'application/json',
                        success: function() {
                            console.log("saved");
                        },
                        type: 'PUT'
                    });
                    return false;
                });
                //initial load
                load();
            });
        </script>
    </body>
</html>
